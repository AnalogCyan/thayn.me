# Netlify configuration file

[build]
# Directory to publish
publish = "public"
command = "npm run build"

[build.environment]
NODE_VERSION = "24"

[[edge_functions]]
path = "/*"
function = "bots"

[images]
remote_images = [
  "https:\\/\\/lastfm\\.freetls\\.fastly\\.net\\/.*",
  "https:\\/\\/lastfm-img2\\.akamaized\\.net\\/.*",
  "https:\\/\\/img2-ak\\.lst\\.fm\\/.*"
]

# Redirects configuration
[[redirects]]
from = "https://git.thayn.me/*"
to = "https://github.com/AnalogCyan/:splat"
status = 301
force = true

[[redirects]]
from = "https://git.thayn.gay/*"
to = "https://github.com/AnalogCyan/:splat"
status = 301
force = true

[[redirects]]
from = "/code-of-conduct.txt"
to = "/.well-known/code-of-conduct.txt"
status = 301

[[redirects]]
from = "/humans.txt"
to = "/.well-known/humans.txt"
status = 301

[[redirects]]
from = "/robots.txt"
to = "/.well-known/robots.txt"
status = 301

[[redirects]]
from = "/security.txt"
to = "/.well-known/security.txt"
status = 301

[[redirects]]
from = "/api/lastfm-now-playing"
to = "/.netlify/functions/lastfm-now-playing"
status = 200

[[redirects]]
from = "/feed.xml"
to = "/blog/rss.xml"
status = 301

[[redirects]]
from = "/rss.xml"
to = "/blog/rss.xml"
status = 301

[[redirects]]
from = "/atom.xml"
to = "/blog/atom.xml"
status = 301

[[redirects]]
from = "/*"
to = "/index.html"
status = 200

# Headers
[[headers]]
for = "/*"
[headers.values]
X-Frame-Options = "DENY"
Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"
X-Content-Type-Options = "nosniff"
X-XSS-Protection = "1; mode=block"
Content-Security-Policy = "default-src 'self'; img-src 'self' data:; script-src 'self'; style-src 'self' https://cdn.jsdelivr.net https://fonts.googleapis.com; font-src 'self' https://cdn.jsdelivr.net https://fonts.gstatic.com; connect-src 'self';"
Referrer-Policy = "strict-origin-when-cross-origin"
Cache-Control = "public, max-age=0, must-revalidate"
AI-Training = "none"
X-Robots-Tag = "noai, noimageai"

# Headers for specific paths
[[headers]]
for = "/media/*"
[headers.values]
Cache-Control = "public, max-age=604800"

[[headers]]
for = "/capsules/*"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/i18n/*"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/blog/scripts/*"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/blog/styles.css"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/styles.css"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/scripts.js"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/scripts/*"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"

[[headers]]
for = "/manifest.json"
[headers.values]
Cache-Control = "public, max-age=300, must-revalidate"
